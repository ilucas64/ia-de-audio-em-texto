<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>IA Inteligente Local</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #dbeafe, #f8fafc);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
    }

    h1 {
      color: #1e3a8a;
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    button {
      font-size: 18px;
      padding: 15px 30px;
      margin: 10px;
      border-radius: 40px;
      background-color: #2563eb;
      color: white;
      border: none;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background-color: #1d4ed8;
    }

    button.listening {
      background-color: #dc2626;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0px #dc2626; }
      50% { box-shadow: 0 0 15px #dc2626; }
      100% { box-shadow: 0 0 0px #dc2626; }
    }

    #textResult {
      width: 90%;
      max-width: 600px;
      height: 80px;
      font-size: 16px;
      margin-top: 10px;
      border-radius: 10px;
      padding: 10px;
      background-color: #fefefe;
      border: 1px solid #ccc;
      resize: none;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    #chatLog {
      width: 90%;
      max-width: 600px;
      margin-top: 20px;
      padding: 20px;
      background: #ffffff;
      border-radius: 12px;
      text-align: left;
      box-shadow: 0 0 10px rgba(0,0,0,0.08);
      max-height: 400px;
      overflow-y: auto;
    }

    .user { color: #1d4ed8; margin-bottom: 5px; font-weight: bold; }
    .ia { color: #059669; margin-bottom: 15px; }
    .loading { color: #6b7280; font-style: italic; }
  </style>
</head>
<body>
  <h1>üß† IA Local Inteligente</h1>
  <button id="micButton" onclick="toggleMic()">üé§ Falar</button>
  <button id="clearButton" onclick="clearChat()">üóëÔ∏è Limpar Chat</button>
  <textarea id="textResult" readonly></textarea>
  <div id="chatLog"></div>

  <script>
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = "pt-BR";
    recognition.interimResults = true;
    recognition.continuous = false; // Garante que o reconhecimento pare ap√≥s cada fala

    let finalTranscript = "";
    let isListening = false;

    const textResult = document.getElementById("textResult");
    const micButton = document.getElementById("micButton");
    const chatLog = document.getElementById("chatLog");

    function toggleMic() {
      if (!isListening) {
        finalTranscript = "";
        textResult.value = "";
        recognition.start();
        micButton.classList.add("listening");
        micButton.textContent = "üî¥ Gravando...";
        isListening = true;
      } else {
        recognition.stop();
      }
    }

    recognition.onresult = (event) => {
      let interim = "";
      for (let i = event.resultIndex; i < event.results.length; i++) {
        const txt = event.results[i][0].transcript;
        if (event.results[i].isFinal) {
          finalTranscript += txt + " ";
        } else {
          interim += txt;
        }
      }
      textResult.value = finalTranscript + interim;
    };

    recognition.onend = () => {
      if (isListening) {
        // Reinicia o reconhecimento para evitar problemas na segunda tentativa
        recognition.start();
      } else {
        if (finalTranscript.trim()) {
          const userText = finalTranscript.trim();
          addToChat("üó£Ô∏è Voc√™: " + userText, "user");
          addToChat("ü§ñ IA: Processando...", "ia loading");
          setTimeout(() => {
            const resposta = processarPergunta(userText);
            chatLog.lastChild.innerText = "ü§ñ IA: " + resposta;
            chatLog.lastChild.className = "ia";
          }, 500); // Simula um pequeno atraso para parecer mais natural
        }
        micButton.classList.remove("listening");
        micButton.textContent = "üé§ Falar";
      }
    };

    recognition.onerror = (event) => {
      addToChat("ü§ñ IA: Desculpe, houve um erro no reconhecimento de voz: " + event.error, "ia");
      micButton.classList.remove("listening");
      micButton.textContent = "üé§ Falar";
      isListening = false;
    };

    function addToChat(texto, classe) {
      const div = document.createElement("div");
      div.className = classe;
      div.innerText = texto;
      chatLog.appendChild(div);
      chatLog.scrollTop = chatLog.scrollHeight;
    }

    function clearChat() {
      chatLog.innerHTML = "";
    }

    function processarPergunta(pergunta) {
      const texto = pergunta.toLowerCase().trim();

      // Sauda√ß√µes b√°sicas
      if (["oi", "ol√°", "e a√≠", "fala", "opa"].some(p => texto.includes(p))) 
        return "Oi! Estou pronta para ajudar. O que voc√™ quer saber hoje?";
      if (texto.includes("bom dia")) 
        return "Bom dia! Espero que seu dia esteja come√ßando bem! üòä";
      if (texto.includes("boa tarde")) 
        return "Boa tarde! Como posso te ajudar agora?";
      if (texto.includes("boa noite")) 
        return "Boa noite! Quer conversar sobre algo especial?";

      // Intera√ß√µes pessoais
      if (texto.includes("tudo bem")) 
        return "Tudo √≥timo por aqui! E contigo, como t√°?";
      if (texto.includes("qual seu nome")) 
        return "Eu sou Grok, sua IA local super amig√°vel!";
      if (texto.includes("como voc√™ est√°")) 
        return "T√¥ de boa, pronta pra responder suas perguntas! üòÑ";
      if (texto.includes("obrigado") || texto.includes("valeu")) 
        return "Por nada! Sempre que precisar, √© s√≥ chamar.";
      if (texto.includes("quem √© voc√™")) 
        return "Sou Grok, uma IA criada pela xAI para ajudar com perguntas e c√°lculos, tudo localmente!";
      if (texto.includes("ajuda")) 
        return "Posso ajudar com c√°lculos, responder perguntas ou s√≥ bater um papo. Tenta algo como 'qual a capital do Brasil?' ou 'quanto √© 10 por cento de 200?'";
      if (texto.includes("o que voc√™ sabe fazer")) 
        return "Eu converso, resolvo contas, respondo perguntas sobre fatos gerais e at√© dou uma m√£ozinha com curiosidades. Experimenta perguntar algo!";

      // Informa√ß√µes factuais
      if (texto.includes("capital do brasil")) 
        return "A capital do Brasil √© Bras√≠lia.";
      if (texto.includes("maior planeta")) 
        return "O maior planeta do sistema solar √© J√∫piter.";
      if (texto.includes("quem descobriu o brasil")) 
        return "O Brasil foi descoberto oficialmente por Pedro √Ålvares Cabral em 22 de abril de 1500.";
      if (texto.includes("quantos continentes")) 
        return "Existem sete continentes habitados: √Åfrica, Ant√°rtida, √Åsia, Austr√°lia, Europa, Am√©rica do Norte e Am√©rica do Sul.";

      // C√°lculos matem√°ticos
      try {
        const expressao = texto
          .replace("quanto √©", "")
          .replace("calcule", "")
          .replace("dividido por", "/")
          .replace("vezes", "*")
          .replace("mais", "+")
          .replace("menos", "-")
          .replace("raiz quadrada de", "Math.sqrt")
          .replace("elevado a", "**")
          .replace(/(\d+)\s*por\s*cento\s*de\s*(\d+)/, "($1/100)*$2"); // Suporte a porcentagens

        if (/[\d\s\+\-\*\/\.\(\)sqrt]/.test(expressao)) {
          const resultado = Function('"use strict";return (' + expressao + ')')();
          if (!isNaN(resultado)) 
            return "O resultado √©: " + resultado.toFixed(2).replace(/\.00$/, "");
        }
      } catch (e) {
        return "Hmm, n√£o consegui calcular isso. Tenta reformular a express√£o, por favor!";
      }

      // Resposta padr√£o
      return "Desculpe, n√£o entendi direito. Tenta reformular ou perguntar algo como 'qual a capital do Brasil?' ou 'calcule 5 vezes 3'.";
    }
  </script>
</body>
</html>